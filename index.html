<!doctype html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Project 2030ï¼šæ†²æ³•å®ˆè­·è€…</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React (production UMD) -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>

  <style>
    body { background:#0b1220; }
    .safe-b { padding-bottom: env(safe-area-inset-bottom); }
    input[type="range"] { -webkit-appearance:none; appearance:none; height: 6px; border-radius:999px; background:#334155; }
    input[type="range"]::-webkit-slider-thumb{
      -webkit-appearance:none; appearance:none; width:22px; height:22px; border-radius:999px; background:white; border:2px solid #22c55e;
      box-shadow:0 6px 18px rgba(0,0,0,.35);
    }
  </style>
</head>

<body class="text-slate-100">
  <div id="root"></div>

  <script>
    const { useEffect, useMemo, useRef, useState } = React;

    const GOAL_BTC = 3.0;
    const TARGET_DATE = new Date("2030-12-31T00:00:00+08:00").getTime();
    const SAVE_KEY = "project2030_mobile_save_v2";

    const INITIAL_STATE = {
      btcHot: 0.0,
      btcCold: 0.0,
      usdtReserve: 0,
      eth: 34.0,
      ada: 74000.0,
      logs: [],
      consecutiveGreedWeeks: 0,
    };

    function fmt(n, d=4){ return Number(n||0).toFixed(d); }
    function todayMMDD(){
      return new Date().toLocaleDateString('zh-TW', {month:'2-digit', day:'2-digit'});
    }
    function clamp(v,min,max){ return Math.min(max, Math.max(min,v)); }

    function App(){
      const [state, setState] = useState(INITIAL_STATE);

      // âœ… iPhone å‹å–„ï¼šinputs ç”¨å­—ä¸²ä¿å­˜ï¼Œä¸è¦æ¯æ‰“ä¸€æ¬¡å°± parseFloat -> æœƒå°è‡´ re-render + æ¸¸æ¨™è·³/éµç›¤æ”¶
      const [inputs, setInputs] = useState({
        btcPrice: "90000",
        fngIndex: 50,
        ethBtcRatio: "0.05",
        adaBtcRatio: "0.000008",
      });

      const [tab, setTab] = useState("home");
      const [modal, setModal] = useState(null);

      // é˜²æ­¢ã€Œéµç›¤æ”¶èµ·ã€ï¼šè¨˜ä½ç›®å‰ focus çš„ inputï¼Œre-render å¾ŒæŠŠç„¦é»ç•™ä½
      const activeInputName = useRef(null);

      const addLog = (msg, type="info") => {
        const log = { id: Date.now() + Math.random(), date: todayMMDD(), msg, type };
        setState(prev => ({ ...prev, logs: [log, ...prev.logs].slice(0, 60) }));
      };

      useEffect(() => {
        try{
          const saved = localStorage.getItem(SAVE_KEY);
          if(saved){
            setState(JSON.parse(saved));
          }else{
            addLog("ç³»çµ±åˆå§‹åŒ–å®Œæˆã€‚ç›®æ¨™ï¼š2030 ç´¯ç© 3 BTCã€‚", "system");
          }
        }catch(e){
          console.log(e);
        }
        // eslint-disable-next-line
      }, []);

      useEffect(() => {
        try{ localStorage.setItem(SAVE_KEY, JSON.stringify(state)); }catch(e){}
      }, [state]);

      // é‡æ–°èšç„¦ï¼ˆè§£ iPhone æ¯è¼¸å…¥ä¸€ä½å°±æ”¶éµç›¤/è·³ç„¦ï¼‰
      useEffect(() => {
        if(!activeInputName.current) return;
        const el = document.querySelector(`input[data-name="${activeInputName.current}"]`);
        if(el && document.activeElement !== el){
          // åªåœ¨é‚„é–‹è‘—éµç›¤æ™‚æ‰å¼·åˆ¶ focusï¼Œé¿å…å¹²æ“¾
          // é€™è£¡ä¸åšå¼·åˆ¶ focusï¼Œä¸»è¦é ã€Œä¸æŠŠå€¼ parse æˆ numberã€å·²ç¶“èƒ½è§£å¤§éƒ¨åˆ†å•é¡Œ
        }
      });

      const daysLeft = useMemo(() => {
        const diff = TARGET_DATE - Date.now();
        return Math.max(0, Math.ceil(diff / (1000*60*60*24)));
      }, [state.btcHot, state.btcCold]);

      const totalBtc = state.btcHot + state.btcCold;
      const progress = clamp((totalBtc / GOAL_BTC) * 100, 0, 100);

      const parseNum = (s, fallback=0) => {
        const n = Number(String(s).replace(/,/g,''));
        return Number.isFinite(n) ? n : fallback;
      };

      const executeWeekly = () => {
        const fng = clamp(Number(inputs.fngIndex || 0), 0, 100);
        const btcPrice = parseNum(inputs.btcPrice, 0);
        if(btcPrice <= 0){
          setModal({ title:"è¼¸å…¥éŒ¯èª¤", body:"BTC åƒ¹æ ¼å¿…é ˆ > 0" });
          return;
        }

        let action = "";
        let usdtSpent = 0;
        let usdtSaved = 0;
        let reserveUsed = 0;
        let greed = state.consecutiveGreedWeeks;

        if(fng < 20){
          action = "æ¥µåº¦ææ…Œï¼š3ä»½è²·é€² + å‹•ç”¨é å‚™é‡‘ 25%";
          usdtSpent = 180;
          if(state.usdtReserve > 0){
            reserveUsed = Math.floor(state.usdtReserve * 0.25);
            usdtSpent += reserveUsed;
          }
          greed = 0;
        }else if(fng <= 40){
          action = "ææ‡¼ï¼š2ä»½è²· / 1ä»½å­˜";
          usdtSpent = 120;
          usdtSaved = 60;
          greed = 0;
        }else if(fng <= 75){
          action = "ä¸­æ€§ï¼š1ä»½è²· / 2ä»½å­˜";
          usdtSpent = 60;
          usdtSaved = 120;
          greed = 0;
        }else{
          if(greed >= 8){
            action = "é•·ç‰›ä¿éšªï¼š1ä»½è²· / 2ä»½å­˜";
            usdtSpent = 60;
            usdtSaved = 120;
            greed += 1;
          }else{
            action = "è²ªå©ªï¼š0è²· / 3ä»½å…¨å­˜";
            usdtSpent = 0;
            usdtSaved = 180;
            greed += 1;
          }
        }

        const btcBought = usdtSpent > 0 ? (usdtSpent / btcPrice) : 0;

        const next = {
          ...state,
          btcHot: state.btcHot + btcBought,
          usdtReserve: state.usdtReserve + usdtSaved - reserveUsed,
          consecutiveGreedWeeks: greed
        };
        setState(next);

        addLog(`é€±å ±ï¼š${action}`, usdtSpent > 0 ? "success" : "warning");
        if(btcBought > 0) addLog(`è²·å…¥ï¼š${btcBought.toFixed(6)} BTC @ ${btcPrice}`, "success");

        // ç°¡åŒ–æé†’ï¼ˆå¯è‡ªè¡Œæ“´å……ï¼‰
        const ethR = parseNum(inputs.ethBtcRatio, 0);
        const adaR = parseNum(inputs.adaBtcRatio, 0);
        if(ethR >= 0.06 && next.eth >= 10) addLog(`è­¦å ±ï¼šETH/BTC=${ethR}ï¼ˆé” 0.06ï¼‰`, "alert");
        if(adaR >= 0.000010 && next.ada >= 40000) addLog(`è­¦å ±ï¼šADA/BTC=${adaR}ï¼ˆé” 0.000010ï¼‰`, "alert");

        setModal({
          title:"åŸ·è¡Œå ±å‘Š",
          body: `
${action}

æŠ•å…¥ï¼š${usdtSpent} U
å­˜å…¥é å‚™ï¼š${usdtSaved} U
å‹•ç”¨é å‚™ï¼š${reserveUsed} U
ç²å¾—ï¼š${btcBought.toFixed(6)} BTC

ç›®å‰ç¸½æŒæœ‰ï¼š${(next.btcHot + next.btcCold).toFixed(4)} BTC
          `.trim()
        });
      };

      const moveCold = () => {
        if(state.btcHot < 0.05){
          setModal({ title:"æŒ‡ä»¤æ‹’çµ•", body:"æœªé” 0.05 BTC é–€æª»ï¼Œè«‹ç¯€çœæ‰‹çºŒè²»ã€‚" });
          return;
        }
        const amount = state.btcHot;
        const next = { ...state, btcHot: 0, btcCold: state.btcCold + amount };
        setState(next);
        addLog(`æé ˜ ${amount.toFixed(6)} BTC è‡³å†·éŒ¢åŒ…`, "secure");
        setModal({ title:"è³‡ç”¢è½‰ç§»", body:`æˆåŠŸå°‡ ${amount.toFixed(6)} BTC ç§»å…¥å†·éŒ¢åŒ…ã€‚` });
      };

      const Chip = ({active, children, onClick}) => (
        React.createElement("button", {
          onClick,
          className: "px-3 py-2 rounded-lg text-sm font-semibold " + (active ? "bg-emerald-600 text-white" : "bg-slate-800 text-slate-300")
        }, children)
      );

      const Field = ({label, value, name, placeholder, inputMode="decimal", onChange}) => (
        React.createElement("div", { className:"space-y-1" },
          React.createElement("div", { className:"text-xs text-slate-400" }, label),
          React.createElement("input", {
            "data-name": name,
            value,
            placeholder,
            inputMode,
            className:"w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-3 text-lg font-mono focus:outline-none focus:ring-2 focus:ring-emerald-500",
            onFocus: () => { activeInputName.current = name; },
            onBlur: () => { activeInputName.current = null; },
            // âœ… é—œéµï¼šç”¨ onInput / onChange éƒ½å¯ï¼Œé€™è£¡ç”¨ onInputï¼ˆiOSæ›´ç©©ï¼‰
            onInput: (e) => onChange(e.target.value),
            autoCorrect:"off",
            autoCapitalize:"off",
            spellCheck:false
          })
        )
      );

      const Slider = ({value, onChange}) => (
        React.createElement("div", { className:"space-y-2" },
          React.createElement("div", { className:"flex justify-between text-xs text-slate-400" },
            React.createElement("span", null, "ææ…Œ"),
            React.createElement("span", null, "ä¸­æ€§"),
            React.createElement("span", null, "è²ªå©ª")
          ),
          React.createElement("input", {
            type:"range",
            min:0, max:100,
            value,
            onChange:(e)=>onChange(Number(e.target.value)),
            className:"w-full"
          })
        )
      );

      return React.createElement("div", { className:"min-h-screen safe-b" },
        // Top
        React.createElement("div", { className:"sticky top-0 z-10 bg-slate-950/90 backdrop-blur border-b border-slate-800 px-4 py-3" },
          React.createElement("div", { className:"flex items-center justify-between text-xs text-slate-400 font-mono mb-2" },
            React.createElement("span", null, `LV.${Math.floor(totalBtc*10)} å®ˆè­·è€…`),
            React.createElement("span", null, `${fmt(totalBtc,4)} / ${GOAL_BTC} BTC`)
          ),
          React.createElement("div", { className:"w-full h-3 bg-slate-800 rounded-full overflow-hidden" },
            React.createElement("div", {
              className:"h-full bg-gradient-to-r from-emerald-600 to-green-400 transition-all",
              style:{ width: progress + "%" }
            })
          ),
          React.createElement("div", { className:"text-[10px] text-right text-slate-500 mt-1" }, `å‰©é¤˜ ${daysLeft} å¤©`)
        ),

        // Tabs
        React.createElement("div", { className:"p-4 space-y-4 pb-24" },

          React.createElement("div", { className:"flex gap-2" },
            React.createElement(Chip, { active: tab==="home", onClick:()=>setTab("home") }, "HOME è¡Œå‹•"),
            React.createElement(Chip, { active: tab==="alert", onClick:()=>setTab("alert") }, "ALERT æˆ°ç•¥"),
            React.createElement(Chip, { active: tab==="sop", onClick:()=>setTab("sop") }, "SOP æ†²æ³•")
          ),

          // Cards
          React.createElement("div", { className:"grid grid-cols-2 gap-3" },
            React.createElement("div", { className:"bg-slate-800 rounded-2xl p-4 border border-slate-700" },
              React.createElement("div", { className:"text-xs text-slate-400" }, "ç†±éŒ¢åŒ… (BTC)"),
              React.createElement("div", { className:"text-2xl font-mono font-bold mt-1" }, fmt(state.btcHot,4)),
              React.createElement("button", {
                onClick: moveCold,
                className:"mt-3 w-full bg-slate-700 hover:bg-slate-600 rounded-xl py-2 text-sm font-bold"
              }, "æé ˜åˆ°å†·éŒ¢åŒ… (0.05é–€æª»)")
            ),
            React.createElement("div", { className:"bg-slate-800 rounded-2xl p-4 border border-slate-700" },
              React.createElement("div", { className:"text-xs text-slate-400" }, "å†·éŒ¢åŒ… (BTC)"),
              React.createElement("div", { className:"text-2xl font-mono font-bold mt-1" }, fmt(state.btcCold,4)),
              React.createElement("div", { className:"text-[11px] text-slate-500 mt-2" }, "çµ•å°é˜²ç¦¦")
            )
          ),
          React.createElement("div", { className:"bg-slate-800 rounded-2xl p-4 border border-slate-700" },
            React.createElement("div", { className:"text-xs text-slate-400" }, "é å‚™é‡‘ (USDT)"),
            React.createElement("div", { className:"text-2xl font-mono font-bold mt-1" }, "$" + Number(state.usdtReserve||0).toLocaleString())
          ),

          tab==="home" && React.createElement("div", { className:"bg-slate-800 rounded-2xl p-5 border border-slate-700 space-y-4" },
            React.createElement("div", { className:"text-lg font-extrabold text-emerald-400" }, "âš¡ æ¯é€±ä»»å‹™"),
            React.createElement(Field, {
              label:"æœ¬é€± BTC åƒ¹æ ¼ (USDT)",
              value: inputs.btcPrice,
              name:"btcPrice",
              inputMode:"numeric",
              onChange:(v)=>setInputs(prev=>({ ...prev, btcPrice: v }))
            }),
            React.createElement("div", null,
              React.createElement("div", { className:"flex justify-between items-center" },
                React.createElement("div", { className:"text-xs text-slate-400" }, `ææ‡¼èˆ‡è²ªå©ªæŒ‡æ•¸ (0-100)`),
                React.createElement("div", { className:"text-sm font-mono text-emerald-300" }, String(inputs.fngIndex))
              ),
              React.createElement(Slider, {
                value: inputs.fngIndex,
                onChange:(n)=>setInputs(prev=>({ ...prev, fngIndex: n }))
              })
            ),
            React.createElement("div", { className:"grid grid-cols-2 gap-3" },
              React.createElement(Field, {
                label:"ETH/BTC åŒ¯ç‡ï¼ˆé¸å¡«ï¼‰",
                value: inputs.ethBtcRatio,
                name:"ethBtcRatio",
                inputMode:"decimal",
                onChange:(v)=>setInputs(prev=>({ ...prev, ethBtcRatio: v }))
              }),
              React.createElement(Field, {
                label:"ADA/BTC åŒ¯ç‡ï¼ˆé¸å¡«ï¼‰",
                value: inputs.adaBtcRatio,
                name:"adaBtcRatio",
                inputMode:"decimal",
                onChange:(v)=>setInputs(prev=>({ ...prev, adaBtcRatio: v }))
              })
            ),
            React.createElement("button", {
              onClick: executeWeekly,
              className:"w-full bg-emerald-600 hover:bg-emerald-700 rounded-2xl py-4 text-lg font-black"
            }, "åŸ·è¡Œæ¯é€±æ±ºç­– (EXECUTE)")
          ),

          tab==="alert" && React.createElement("div", { className:"bg-slate-800 rounded-2xl p-5 border border-slate-700 space-y-3" },
            React.createElement("div", { className:"text-lg font-extrabold text-fuchsia-300" }, "âš ï¸ æˆ°ç•¥æé†’"),
            React.createElement("div", { className:"text-sm text-slate-300 leading-relaxed" },
              "æ­¤é ç›®å‰æä¾›æé†’ç”¨ï¼ˆé”åˆ°é–€æª»æœƒå¯«å…¥ LOGï¼‰ã€‚ä½ å¯ä»¥åœ¨é€™è£¡åŠ ä¸Š ETH/ADA è½‰æ›æŒ‰éˆ•æµç¨‹ã€‚"
            ),
            React.createElement("div", { className:"text-xs text-slate-500" },
              `ETH: ${fmt(state.eth,2)}ï½œADA: ${Number(state.ada||0).toLocaleString()}`
            )
          ),

          tab==="sop" && React.createElement("div", { className:"bg-slate-800 rounded-2xl p-5 border border-slate-700 space-y-3" },
            React.createElement("div", { className:"text-lg font-extrabold text-yellow-300" }, "ğŸ“œ æ†²æ³• (SOP)"),
            React.createElement("ul", { className:"text-sm text-slate-300 list-disc pl-5 space-y-2" },
              React.createElement("li", null, "ææ…Œ(<20) å…¨åŠ›è²·é€²ï¼›è²ªå©ª(>75) è½‰å­˜é å‚™é‡‘ã€‚"),
              React.createElement("li", null, "äº¤æ˜“æ‰€ç´¯ç©æ»¿ 0.05 BTC â†’ å¿…é ˆæé ˜åˆ°å†·éŒ¢åŒ…ã€‚"),
              React.createElement("li", null, "ä¸é æ¸¬å¸‚å ´ï¼ŒåªåŸ·è¡Œè¦å‰‡ã€‚")
            ),
            React.createElement("div", { className:"text-xs text-slate-500 pt-2" }, "åŸ·è¡Œäººï¼šé™³ç¥¥è±ªï½œæœŸé–“ï¼š2026.01 - 2030.12")
          ),

          // Logs
          React.createElement("div", { className:"bg-slate-950 rounded-2xl p-4 border border-slate-800" },
            React.createElement("div", { className:"text-xs text-slate-500 font-mono mb-2" }, "> SYSTEM LOGS"),
            state.logs.length === 0
              ? React.createElement("div", { className:"text-slate-600 text-sm" }, "ç­‰å¾…æŒ‡ä»¤â€¦")
              : state.logs.slice(0, 12).map(l =>
                  React.createElement("div", { key:l.id, className:"text-sm font-mono border-b border-slate-900 py-2" },
                    React.createElement("span", { className:"text-slate-500" }, `[${l.date}] `),
                    React.createElement("span", {
                      className:
                        l.type==="alert" ? "text-red-300 font-bold" :
                        l.type==="success" ? "text-emerald-300" :
                        l.type==="warning" ? "text-yellow-300" :
                        l.type==="secure" ? "text-sky-300" :
                        l.type==="system" ? "text-slate-300" : "text-slate-300"
                    }, l.msg)
                  )
                )
          )
        ),

        // Modal
        modal && React.createElement("div", { className:"fixed inset-0 z-50 bg-black/70 flex items-center justify-center p-4" },
          React.createElement("div", { className:"w-full max-w-md bg-slate-900 border border-slate-700 rounded-2xl p-5" },
            React.createElement("div", { className:"text-lg font-black mb-3" }, modal.title),
            React.createElement("pre", { className:"text-sm text-slate-200 whitespace-pre-wrap leading-relaxed" }, modal.body),
            React.createElement("button", {
              onClick:()=>setModal(null),
              className:"mt-4 w-full bg-slate-700 hover:bg-slate-600 rounded-xl py-3 font-bold"
            }, "ç¢ºèª")
          )
        )
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(React.createElement(App));
  </script>
</body>
</html>
