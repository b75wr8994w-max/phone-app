<!doctype html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Project 2030ï¼šåŸ·è¡Œæ†²æ³•ï¼ˆ3 BTCï¼‰</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React (production UMD) -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>

  <style>
    body { background:#0b1220; -webkit-tap-highlight-color: transparent; }
    .safe-b { padding-bottom: env(safe-area-inset-bottom); }
    input, button, textarea, select { font-size: 16px; } /* iOS: é˜²ç¸®æ”¾/è·³éµç›¤ */
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .pb-safe { padding-bottom: calc(88px + env(safe-area-inset-bottom)); }
  </style>
</head>

<body class="text-slate-100">
  <div id="root"></div>

<script>
const { useEffect, useMemo, useRef, useState } = React;

/** ========= è¨­å®šï¼ˆèˆ‡ä½ çš„æ†²æ³•å°é½Šï¼‰ ========= */
const GOAL_BTC = 3.0;
const TARGET_DATE = new Date("2030-12-31T00:00:00+08:00").getTime();
const SAVE_KEY = "project2030_exec_constitution_v1";

/** DCAï¼šæ¯æœˆ 180 USDTï¼ˆ3ä»½ï¼Œæ¯ä»½ 60ï¼‰ */
const PART = 60;
const MONTHLY = 180;

/** é•·ç‰›ä¿éšªï¼šFNG > 75 é€£çºŒ 8 é€±å¾Œå•Ÿå‹•ï¼ˆç´„ 2 å€‹æœˆï¼‰ï¼Œä¹‹å¾Œæ¯é€±å¼·åˆ¶è²· 1 ä»½ */
const GREED_THRESHOLD = 75;
const GREED_WEEKS_FOR_INSURANCE = 8;

/** é»‘å¤©éµï¼šé å‚™é‡‘åˆ† 4 é€±ç­‰é¡è²·å…¥ï¼›åå½ˆ > 15% åœæ­¢ */
const BLACK_SWAN_WEEKS = 4;
const BLACK_SWAN_STOP_REBOUND = 15;

/** ETH ç­–ç•¥é–€æª» */
const ETH_STAGE1 = 0.060;
const ETH_STAGE2 = 0.065;
const ETH_STAGE3 = 0.075;

/** ADA ç­–ç•¥é–€æª» */
const ADA_STAGE1 = 0.000010;
const ADA_STAGE2 = 0.000013;

/** ETH æ›å–®å›æ¥ï¼šBTC å›æ’¤ 15% / 20% */
const BUYBACK_DROP_STAGE1 = 15; // %
const BUYBACK_DROP_STAGE2 = 20; // %
const BUYBACK_DEADLINE_DAYS = 90;

/** ========= åˆå§‹ç‹€æ…‹ ========= */
const INITIAL_STATE = {
  // BTC
  btcHot: 0.0,
  btcCold: 0.0,

  // Stable
  usdtReserve: 0, // DCA æ²’è²·çš„ä»½é¡ + é¡å¤–é–’ç½®è³‡é‡‘ï¼ˆä½ å¯æ‰‹å‹•åŠ ï¼‰
  // è½‰æ›æœŸ USDTï¼ˆä¾†è‡ª ETH æ··åˆç­–ç•¥ï¼‰æœƒé€²å…¥ pendingOrdersï¼Œä¸ç›´æ¥æ··åœ¨ reserve

  // Alts
  eth: 34.0,
  ada: 74000.0,

  // logs
  logs: [],

  // DCA è¨ˆæ•¸
  consecutiveGreedWeeks: 0,

  // é»‘å¤©éµè²·å…¥è¨ˆç•«
  blackSwan: {
    active: false,
    remainingWeeks: 0,
    weeklyBudget: 0,
    startedAtISO: null,
    reason: null
  },

  // ETH æ› USDT æ›å–®å›æ¥ï¼ˆæ¨¡æ“¬ã€ç”¨ä½ è¼¸å…¥çš„ BTC åƒ¹æ ¼ï¼‰
  pendingOrders: [
    // { id, createdAtISO, deadlineISO, usdtAmount, refBtcPrice, dropPct, targetPrice, status:"open"|"closed", closedReason, btcReceived }
  ],

  // è¨­å®šï¼šæé†’é–¾å€¼
  alerts: {
    ethBtcWatch: 0.045,
    adaBtcWatch: 0.0000095
  }
};

/** ========= å°å·¥å…· ========= */
function todayMMDD(){
  return new Date().toLocaleDateString('zh-TW', {month:'2-digit', day:'2-digit'});
}
function clamp(v, min, max){ return Math.min(max, Math.max(min, v)); }
function parseNum(s, fallback = NaN){
  const n = Number(String(s ?? "").replace(/,/g,"").trim());
  return Number.isFinite(n) ? n : fallback;
}
function fmt(n, d=4){ return Number(n||0).toFixed(d); }
function isoPlusDays(days){
  const d = new Date();
  d.setDate(d.getDate() + days);
  return d.toISOString();
}
function daysBetween(isoA, isoB){
  const a = new Date(isoA).getTime();
  const b = new Date(isoB).getTime();
  return Math.floor((b - a) / (1000*60*60*24));
}

/** ========= App ========= */
function App(){
  const [state, setState] = useState(INITIAL_STATE);
  const [tab, setTab] = useState("home");
  const [modal, setModal] = useState(null);

  /**
   * iPhone è¼¸å…¥ç©©å®šï¼šæ‰€æœ‰æ¬„ä½ä½¿ç”¨ draftRef æš«å­˜å­—ä¸²ï¼Œ
   * onBlur æ‰å¯«å…¥ uiï¼ˆé¿å…æ¯è¼¸å…¥ä¸€å­— re-render é€ æˆéµç›¤æ”¶èµ·ï¼‰
   */
  const draftRef = useRef({
    btcPrice: "90000",
    fngIndex: "50",
    ethBtcRatio: "0.050",
    adaBtcRatio: "0.000008",
    athDrawdownPct: "0",
    below200w: "0",      // 0/1
    reboundPct: "0",     // é»‘å¤©éµåå½ˆ %
    extraReserveAdd: "0" // æ‰‹å‹•è£œå……é å‚™é‡‘
  });

  const [ui, setUi] = useState({
    btcPrice: 90000,
    fngIndex: 50,
    ethBtcRatio: 0.050,
    adaBtcRatio: 0.000008,
    athDrawdownPct: 0,
    below200w: 0,
    reboundPct: 0
  });

  const addLog = (msg, type="info") => {
    const log = { id: Date.now() + Math.random(), date: todayMMDD(), msg, type };
    setState(prev => ({ ...prev, logs: [log, ...prev.logs].slice(0, 80) }));
  };

  /** Load/Save */
  useEffect(() => {
    try{
      const saved = localStorage.getItem(SAVE_KEY);
      if(saved){
        const parsed = JSON.parse(saved);
        setState(parsed);
      }else{
        addLog("ç³»çµ±åˆå§‹åŒ–å®Œæˆã€‚ç›®æ¨™ï¼š2030 ç´¯ç© 3 BTCã€‚", "system");
      }
    }catch(e){
      console.log(e);
    }
    // eslint-disable-next-line
  }, []);

  useEffect(() => {
    try{ localStorage.setItem(SAVE_KEY, JSON.stringify(state)); }catch(e){}
  }, [state]);

  /** é€²åº¦æ¢ */
  const totalBtc = state.btcHot + state.btcCold;
  const progress = clamp((totalBtc / GOAL_BTC) * 100, 0, 100);
  const daysLeft = useMemo(() => Math.max(0, Math.ceil((TARGET_DATE - Date.now())/(1000*60*60*24))), [totalBtc]);

  /** æŠ•çµ„ä¼°å€¼ï¼ˆç”¨ä½ è¼¸å…¥çš„ BTC åƒ¹æ ¼èˆ‡åŒ¯ç‡ç²—ä¼°ï¼Œç”¨æ–¼ç©©å®šå¹£å æ¯”æç¤ºï¼‰ */
  const stableTotal = useMemo(() => {
    const openOrders = state.pendingOrders.filter(o => o.status === "open");
    const ordersUsdt = openOrders.reduce((s,o)=>s + (o.usdtAmount||0), 0);
    return (state.usdtReserve||0) + ordersUsdt;
  }, [state.usdtReserve, state.pendingOrders]);

  const portfolioUsdApprox = useMemo(() => {
    const btcUSD = totalBtc * (ui.btcPrice || 0);
    const ethUSD = state.eth * (ui.ethBtcRatio || 0) * (ui.btcPrice || 0);
    const adaUSD = state.ada * (ui.adaBtcRatio || 0) * (ui.btcPrice || 0);
    return btcUSD + ethUSD + adaUSD + stableTotal;
  }, [totalBtc, ui.btcPrice, ui.ethBtcRatio, ui.adaBtcRatio, state.eth, state.ada, stableTotal]);

  const stablePct = useMemo(() => {
    if(!(portfolioUsdApprox > 0)) return 0;
    return stableTotal / portfolioUsdApprox * 100;
  }, [stableTotal, portfolioUsdApprox]);

  /** ========== æ ¸å¿ƒï¼šæ¯é€±åŸ·è¡Œï¼ˆç¬¬ä¸€ç«  + é»‘å¤©éµè²·å…¥ + æ›å–®æª¢æŸ¥ï¼‰ ========== */
  const executeWeekly = () => {
    const btcPrice = Number(ui.btcPrice || 0);
    const fng = clamp(Number(ui.fngIndex || 0), 0, 100);

    if(!(btcPrice > 0)){
      setModal({ title:"è¼¸å…¥éŒ¯èª¤", body:"BTC åƒ¹æ ¼å¿…é ˆ > 0" });
      return;
    }

    // 1) å…ˆè·‘ 90å¤©æœ€æ™šå›å®¶ï¼ˆå° pendingOrdersï¼‰
    const nowISO = new Date().toISOString();
    let forcedBuybacks = [];
    let updatedOrders = state.pendingOrders.map(o => {
      if(o.status !== "open") return o;
      if(new Date(o.deadlineISO).getTime() <= Date.now()){
        // å¼·åˆ¶ç”¨ç•¶å‰ btcPrice å¸‚åƒ¹è²·å›
        const btcBought = (o.usdtAmount || 0) / btcPrice;
        forcedBuybacks.push({ id:o.id, btcBought });
        return {
          ...o,
          status: "closed",
          closedReason: "deadline_force_buyback",
          btcReceived: btcBought,
          closedAtISO: nowISO
        };
      }
      return o;
    });

    // è‹¥æœ‰å¼·åˆ¶è²·å›ï¼Œå°‡ BTC åŠ å…¥ btcHot
    let btcFromForced = forcedBuybacks.reduce((s,x)=>s + x.btcBought, 0);

    // 2) DCA æ±ºç­–ï¼ˆç¬¬ä¸€ç«  + é•·ç‰›ä¿éšªï¼‰
    let action = "";
    let usdtSpent = 0;
    let usdtSaved = 0;
    let greedWeeks = state.consecutiveGreedWeeks;

    if(fng < 20){
      action = "A æ¥µåº¦ææ…Œï¼šæŠ•å…¥ 3 ä»½ + å•Ÿå‹•é»‘å¤©éµé å‚™é‡‘";
      usdtSpent = MONTHLY;
      greedWeeks = 0;
    }else if(fng <= 40){
      action = "B ææ‡¼ï¼š2 ä»½è²· / 1 ä»½å­˜";
      usdtSpent = PART*2;
      usdtSaved = PART*1;
      greedWeeks = 0;
    }else if(fng <= 75){
      action = "C ä¸­æ€§/åè²ªï¼š1 ä»½è²· / 2 ä»½å­˜";
      usdtSpent = PART*1;
      usdtSaved = PART*2;
      greedWeeks = 0;
    }else{
      // >75 è²ªå©ª
      if(greedWeeks >= GREED_WEEKS_FOR_INSURANCE){
        action = "D è²ªå©ªï¼šé•·ç‰›ä¿éšªå•Ÿå‹•ï¼ˆ1 ä»½è²· / 2 ä»½å­˜ï¼‰";
        usdtSpent = PART*1;
        usdtSaved = PART*2;
        greedWeeks += 1;
      }else{
        action = "D è²ªå©ªï¼šåœæ­¢ä¸»å‹•è²·é€²ï¼ˆ3 ä»½å…¨å­˜ï¼‰";
        usdtSpent = 0;
        usdtSaved = PART*3;
        greedWeeks += 1;
      }
    }

    // 3) é»‘å¤©éµè§¸ç™¼ï¼ˆç¬¬ä¸‰ç« ï¼‰
    // è§¸ç™¼æ¢ä»¶ï¼šFNG<20 OR ATH å›æ’¤ >=30 OR è·Œç ´200W MA
    const athDD = clamp(Number(ui.athDrawdownPct || 0), 0, 100);
    const below200w = Number(ui.below200w || 0) === 1;
    const blackSwanTriggered = (fng < 20) || (athDD >= 30) || below200w;

    let blackSwan = { ...state.blackSwan };
    let blackSwanSpentThisWeek = 0;

    // åå½ˆåœæ­¢æ©Ÿåˆ¶ï¼ˆå¦‚æœè²·å…¥æœŸä¸­å›å½ˆ > 15% åœæ­¢ï¼‰
    const rebound = clamp(Number(ui.reboundPct || 0), 0, 100);
    if(blackSwan.active && rebound > BLACK_SWAN_STOP_REBOUND){
      addLog(`é»‘å¤©éµåœæ­¢ï¼šåå½ˆ ${rebound}% > ${BLACK_SWAN_STOP_REBOUND}%ï¼ˆä¿ç•™å‰©é¤˜å­å½ˆï¼‰`, "warning");
      blackSwan = { active:false, remainingWeeks:0, weeklyBudget:0, startedAtISO:blackSwan.startedAtISO, reason:blackSwan.reason };
    }

    // å•Ÿå‹•é»‘å¤©éµè¨ˆç•«ï¼šæŠŠã€Œç•¶ä¸‹é å‚™é‡‘ã€åˆ† 4 é€±
    if(!blackSwan.active && blackSwanTriggered){
      const reserveNow = state.usdtReserve + usdtSaved; // æœ¬é€±å­˜å…¥å…ˆç®—é€²å»ï¼ˆç¬¦åˆä½ ã€Œé å‚™é‡‘ä¾†æºï¼šæœªæŠ•å…¥ä»½é¡ã€ï¼‰
      if(reserveNow > 0){
        const weekly = reserveNow / BLACK_SWAN_WEEKS;
        const reason = (fng < 20) ? "FNG<20" : (athDD >= 30 ? "ATHå›æ’¤>=30%" : "è·Œç ´200W");
        blackSwan = {
          active:true,
          remainingWeeks: BLACK_SWAN_WEEKS,
          weeklyBudget: weekly,
          startedAtISO: nowISO,
          reason
        };
        addLog(`é»‘å¤©éµå•Ÿå‹•ï¼šåŸå› =${reason}ï¼Œé å‚™é‡‘ ${Math.floor(reserveNow)}U åˆ† ${BLACK_SWAN_WEEKS} é€±è²·å…¥`, "alert");
      }
    }

    // è‹¥é»‘å¤©éµ activeï¼šæœ¬é€±è²·å…¥ä¸€ä»½é€±é¡ï¼ˆç›´åˆ°ç”¨å®Œæˆ–å‰©é¤˜é€±æ•¸ç‚º0ï¼‰
    // æ³¨æ„ï¼šé€™æ˜¯ã€Œé å‚™é‡‘é¡å¤–è²·å…¥ã€åŠ åœ¨ DCA spend ä¹‹å¤–
    let reserveAfterSave = state.usdtReserve + usdtSaved; // å…ˆæŠŠæœ¬é€±å­˜å…¥åŠ é€²é å‚™é‡‘
    if(blackSwan.active && blackSwan.remainingWeeks > 0){
      const maxCanSpend = reserveAfterSave;
      const planned = blackSwan.weeklyBudget;
      const spend = Math.max(0, Math.min(maxCanSpend, planned));
      if(spend > 0){
        blackSwanSpentThisWeek = spend;
        reserveAfterSave -= spend;
        blackSwan = {
          ...blackSwan,
          remainingWeeks: blackSwan.remainingWeeks - 1
        };
        addLog(`é»‘å¤©éµè²·å…¥ï¼šæœ¬é€±å‹•ç”¨é å‚™é‡‘ ${Math.floor(spend)}Uï¼ˆå‰© ${blackSwan.remainingWeeks} é€±ï¼‰`, "success");
      }
      if(blackSwan.remainingWeeks - 1 <= 0){
        blackSwan = { ...blackSwan, active:false, remainingWeeks:0 };
        addLog("é»‘å¤©éµçµæŸï¼š4 é€±è²·å…¥å®Œæˆ", "system");
      }
    }

    // 4) è¨ˆç®—æœ¬é€± BTC è²·å…¥ï¼ˆDCA spend + é»‘å¤©éµ spendï¼‰
    const totalSpent = usdtSpent + blackSwanSpentThisWeek;
    const btcBought = totalSpent > 0 ? (totalSpent / btcPrice) : 0;

    // 5) æ›´æ–° state
    const next = {
      ...state,
      btcHot: state.btcHot + btcBought + btcFromForced,
      usdtReserve: reserveAfterSave, // å·²æ‰£æ‰é»‘å¤©éµèŠ±è²»
      consecutiveGreedWeeks: greedWeeks,
      blackSwan,
      pendingOrders: updatedOrders
    };
    setState(next);

    // Logs
    addLog(`é€±å ±ï¼š${action}`, usdtSpent > 0 ? "success" : "warning");
    if(totalSpent > 0) addLog(`æœ¬é€±æŠ•å…¥ï¼š${Math.floor(totalSpent)}U â†’ è²·å…¥ ${btcBought.toFixed(6)} BTC @ ${btcPrice}`, "success");
    if(btcFromForced > 0) addLog(`90å¤©æœ€æ™šå›å®¶ï¼šå¼·åˆ¶è²·å› +${btcFromForced.toFixed(6)} BTCï¼ˆå¸‚åƒ¹ï¼‰`, "alert");

    // 6) æª¢æŸ¥æ›å–®ç›®æ¨™ï¼ˆå¦‚æœ BTC åƒ¹æ ¼ <= targetPriceï¼Œç«‹å³æ¥å›ï¼‰
    // é€™è£¡ä¸è‡ªå‹•åšï¼Œé¿å…ä¸€å€‹æŒ‰éˆ•åšå¤ªå¤šï¼›æ”¹æˆæç¤ºä½ å»ã€Œæ›å–®ã€é é»ã€Œæª¢æŸ¥/æ¥å›ã€
    // ä½†æœƒæç¤ºæ˜¯å¦æœ‰é”æ¨™
    const openOrders = updatedOrders.filter(o => o.status==="open");
    const hit = openOrders.filter(o => (ui.btcPrice || 0) <= (o.targetPrice || -1));
    if(hit.length > 0){
      addLog(`æ›å–®é”æ¨™æé†’ï¼šæœ‰ ${hit.length} ç­† USDT æ›å–®å·²é”æ¥å›åƒ¹ï¼ˆå»ã€æ›å–®ã€‘é ä¸€éµæ¥å›ï¼‰`, "alert");
    }

    // 7) ç©©å®šå¹£å æ¯”æç¤ºï¼ˆ>30% ä¸”éè½‰æ›æœŸä¾‹å¤–ï¼‰
    const hasConversionPeriod = updatedOrders.some(o => o.status==="open");
    if(!hasConversionPeriod && stablePct > 30){
      addLog(`é¢¨æ§æé†’ï¼šç©©å®šå¹£å æ¯”ç´„ ${stablePct.toFixed(1)}% > 30%ï¼ˆéè½‰æ›æœŸï¼‰`, "warning");
    }

    setModal({
      title:"é€±åŸ·è¡Œå®Œæˆ",
      body: `
${action}

DCA æŠ•å…¥ï¼š${usdtSpent} U
æœ¬é€±å­˜å…¥é å‚™ï¼š${usdtSaved} U
é»‘å¤©éµæœ¬é€±å‹•ç”¨ï¼š${Math.floor(blackSwanSpentThisWeek)} U
æœ¬é€±ç¸½æŠ•å…¥ï¼š${Math.floor(totalSpent)} U
è²·å…¥ BTCï¼š${btcBought.toFixed(6)} é¡†

ç›®å‰ç¸½æŒæœ‰ï¼š${(next.btcHot + next.btcCold).toFixed(4)} BTC
é å‚™é‡‘é¤˜é¡ï¼š${Math.floor(next.usdtReserve)} U
      `.trim()
    });
  };

  /** ========== å†·éŒ¢åŒ…éµå¾‹ ========== */
  const moveCold = () => {
    if(state.btcHot < 0.05){
      setModal({ title:"æŒ‡ä»¤æ‹’çµ•", body:"æœªé” 0.05 BTC é–€æª»ï¼Œè«‹ç¯€çœæ‰‹çºŒè²»ã€‚" });
      return;
    }
    const amount = state.btcHot;
    setState(prev => ({ ...prev, btcHot:0, btcCold: prev.btcCold + amount }));
    addLog(`æé ˜ ${amount.toFixed(6)} BTC è‡³å†·éŒ¢åŒ…`, "secure");
    setModal({ title:"è³‡ç”¢è½‰ç§»", body:`æˆåŠŸå°‡ ${amount.toFixed(6)} BTC ç§»å…¥å†·éŒ¢åŒ…ã€‚` });
  };

  /** ========== é‡ç½® ========== */
  const resetAll = () => {
    try{ localStorage.removeItem(SAVE_KEY); }catch(e){}
    setState({ ...INITIAL_STATE, logs: [] });
    setUi({
      btcPrice: 90000,
      fngIndex: 50,
      ethBtcRatio: 0.050,
      adaBtcRatio: 0.000008,
      athDrawdownPct: 0,
      below200w: 0,
      reboundPct: 0
    });
    draftRef.current = {
      btcPrice: "90000",
      fngIndex: "50",
      ethBtcRatio: "0.050",
      adaBtcRatio: "0.000008",
      athDrawdownPct: "0",
      below200w: "0",
      reboundPct: "0",
      extraReserveAdd: "0"
    };
    setModal({ title:"å·²é‡ç½®", body:"æ‰€æœ‰è³‡æ–™å·²æ¸…ç©ºï¼Œä¸¦å›åˆ°åˆå§‹å€¼ã€‚" });
  };

  /** ========== æ‰‹å‹•è£œå……é å‚™é‡‘ï¼ˆç¬¦åˆä½ ç¬¬ä¸‰ç« ï¼šé¡å¤–é–’ç½®ç¾é‡‘ï¼‰ ========== */
  const addExtraReserve = () => {
    const add = Math.max(0, Math.floor(parseNum(draftRef.current.extraReserveAdd, 0)));
    if(!(add > 0)){
      setModal({ title:"è¼¸å…¥éŒ¯èª¤", body:"è«‹è¼¸å…¥è¦è£œå……çš„é å‚™é‡‘ï¼ˆæ­£æ•´æ•¸ï¼‰" });
      return;
    }
    setState(prev => ({ ...prev, usdtReserve: prev.usdtReserve + add }));
    addLog(`æ‰‹å‹•è£œå……é å‚™é‡‘ï¼š+${add} U`, "success");
    draftRef.current.extraReserveAdd = "0";
    setModal({ title:"è£œå……æˆåŠŸ", body:`å·²è£œå……é å‚™é‡‘ +${add} U` });
  };

  /** ========== ç¬¬äºŒç« ï¼šè½‰æ›åŸ·è¡Œï¼ˆç”¨ä½ æ‰‹å‹•è¼¸å…¥å¯¦éš›æ›åˆ°çš„æ•¸é‡ï¼‰ ========== */
  const executeConvertDirectToBTC = (asset, amountAsset, btcReceived) => {
    const amount = Number(amountAsset);
    const btc = Number(btcReceived);
    if(!(amount > 0) || !(btc > 0)) return false;

    setState(prev => {
      const next = { ...prev };
      if(asset === "ETH"){
        if(next.eth < amount) return prev;
        next.eth -= amount;
      }else if(asset === "ADA"){
        if(next.ada < amount) return prev;
        next.ada -= amount;
      }
      next.btcHot += btc;
      return next;
    });
    addLog(`[è½‰æ›] ${amount} ${asset} â†’ ${btc.toFixed(6)} BTCï¼ˆç›´æ¥æ› BTCï¼‰`, "success");
    return true;
  };

  const createUsdtBuybackOrder = (usdtAmount, dropPct) => {
    const btcPrice = Number(ui.btcPrice || 0);
    if(!(btcPrice > 0)) return null;
    const usdt = Number(usdtAmount);
    if(!(usdt > 0)) return null;

    const targetPrice = btcPrice * (1 - dropPct/100);
    return {
      id: Date.now() + Math.random(),
      createdAtISO: new Date().toISOString(),
      deadlineISO: isoPlusDays(BUYBACK_DEADLINE_DAYS),
      usdtAmount: usdt,
      refBtcPrice: btcPrice,
      dropPct,
      targetPrice,
      status: "open",
      btcReceived: 0
    };
  };

  const executeConvertToUSDTWithOrder = (ethAmount, usdtReceived, dropPct) => {
    const eth = Number(ethAmount);
    const usdt = Number(usdtReceived);
    if(!(eth > 0) || !(usdt > 0)) return false;

    const order = createUsdtBuybackOrder(usdt, dropPct);
    if(!order){
      setModal({ title:"ç¼ºå°‘è³‡æ–™", body:"è«‹å…ˆåœ¨ HOME è¼¸å…¥ BTC åƒ¹æ ¼ï¼Œæ‰èƒ½å»ºç«‹å›æ¥æ›å–®ç›®æ¨™ã€‚" });
      return false;
    }

    setState(prev => {
      if(prev.eth < eth) return prev;
      return {
        ...prev,
        eth: prev.eth - eth,
        pendingOrders: [order, ...prev.pendingOrders]
      };
    });

    addLog(`[è½‰æ›] ${eth} ETH â†’ ${usdt.toFixed(0)} USDTï¼ˆæ›å–®ï¼šå›æ’¤ ${dropPct}% æ¥å›ï¼›90å¤©æœ€æ™šå›å®¶ï¼‰`, "warning");
    return true;
  };

  /** æ›å–®ï¼šæª¢æŸ¥æ˜¯å¦é”æ¨™ï¼Œé”æ¨™å‰‡æ¥å›ï¼ˆç”¨ç›®å‰ btcPrice å¸‚åƒ¹æ¨¡æ“¬ï¼‰ */
  const checkAndBuybackOrders = () => {
    const btcPrice = Number(ui.btcPrice || 0);
    if(!(btcPrice > 0)){
      setModal({ title:"ç¼ºå°‘è³‡æ–™", body:"è«‹å…ˆåœ¨ HOME è¼¸å…¥ BTC åƒ¹æ ¼ã€‚" });
      return;
    }

    const nowISO = new Date().toISOString();
    let btcGained = 0;

    const updated = state.pendingOrders.map(o => {
      if(o.status !== "open") return o;

      if(btcPrice <= o.targetPrice){
        const btcBought = (o.usdtAmount || 0) / btcPrice;
        btcGained += btcBought;
        return {
          ...o,
          status: "closed",
          closedReason: "target_hit_buyback",
          btcReceived: btcBought,
          closedAtISO: nowISO
        };
      }
      return o;
    });

    if(btcGained > 0){
      setState(prev => ({ ...prev, btcHot: prev.btcHot + btcGained, pendingOrders: updated }));
      addLog(`[æ›å–®æ¥å›] é”æ¨™æ¥å›ï¼š+${btcGained.toFixed(6)} BTCï¼ˆå¸‚åƒ¹ï¼‰`, "success");
      setModal({ title:"æ¥å›å®Œæˆ", body:`å·²æ¥å› BTC +${btcGained.toFixed(6)} é¡†ï¼ˆä»¥ç›®å‰ BTC åƒ¹æ ¼è¨ˆç®—ï¼‰` });
    }else{
      setState(prev => ({ ...prev, pendingOrders: updated }));
      setModal({ title:"æœªé”æ¨™", body:"ç›®å‰æ²’æœ‰æ›å–®é”åˆ°æ¥å›åƒ¹ä½ã€‚" });
    }
  };

  /** ========= UI å…ƒä»¶ï¼ˆä¿æŒç°¡æ½”ã€å¯é»ã€iPhoneç©©ï¼‰ ========= */
  const Chip = ({active, children, onClick}) => (
    React.createElement("button", {
      onClick,
      className: "px-3 py-2 rounded-xl text-sm font-semibold " + (active ? "bg-emerald-600 text-white" : "bg-slate-800 text-slate-300")
    }, children)
  );

  const Field = ({label, name, inputMode="decimal", placeholder=""}) => (
    React.createElement("div", { className:"space-y-1" },
      React.createElement("div", { className:"text-xs text-slate-400" }, label),
      React.createElement("input", {
        defaultValue: draftRef.current[name],
        inputMode,
        placeholder,
        className:"w-full bg-slate-900 border border-slate-700 rounded-2xl px-4 py-3 text-lg mono focus:outline-none focus:ring-2 focus:ring-emerald-500",
        onInput: (e)=> { draftRef.current[name] = e.target.value; },
        onBlur: ()=> {
          const v = parseNum(draftRef.current[name], NaN);
          if(Number.isFinite(v)){
            setUi(prev => ({ ...prev, [name]: v }));
          }
        },
        autoCorrect:"off", autoCapitalize:"off", spellCheck:false
      })
    )
  );

  const Toggle01 = ({label, name}) => (
    React.createElement("div", { className:"flex items-center justify-between bg-slate-900 border border-slate-700 rounded-2xl px-4 py-3" },
      React.createElement("div", { className:"text-sm text-slate-200" }, label),
      React.createElement("button", {
        className: "px-3 py-2 rounded-xl text-xs font-bold " + (Number(ui[name]||0)===1 ? "bg-emerald-600" : "bg-slate-700"),
        onClick: ()=> {
          const next = Number(ui[name]||0)===1 ? 0 : 1;
          setUi(prev => ({ ...prev, [name]: next }));
          draftRef.current[name] = String(next);
        }
      }, Number(ui[name]||0)===1 ? "ON" : "OFF")
    )
  );

  const SectionTitle = ({left, right}) => (
    React.createElement("div", { className:"flex items-center justify-between" },
      React.createElement("div", { className:"text-lg font-extrabold text-emerald-400" }, left),
      right
    )
  );

  /** ========= Strategy helpers for display ========= */
  const ethStage = useMemo(() => {
    const r = ui.ethBtcRatio || 0;
    if(r >= ETH_STAGE3) return 3;
    if(r >= ETH_STAGE2) return 2;
    if(r >= ETH_STAGE1) return 1;
    return 0;
  }, [ui.ethBtcRatio]);

  const adaStage = useMemo(() => {
    const r = ui.adaBtcRatio || 0;
    if(r >= ADA_STAGE2) return 2;
    if(r >= ADA_STAGE1) return 1;
    return 0;
  }, [ui.adaBtcRatio]);

  /** ========= Render ========= */
  return React.createElement("div", { className:"min-h-screen pb-safe" },

    /** Top Bar */
    React.createElement("div", { className:"sticky top-0 z-10 bg-slate-950/90 backdrop-blur border-b border-slate-800 px-4 py-3" },
      React.createElement("div", { className:"flex items-center justify-between text-xs text-slate-400 mono mb-2" },
        React.createElement("span", null, `LV.${Math.floor(totalBtc*10)} å®ˆè­·è€…`),
        React.createElement("span", null, `${fmt(totalBtc,4)} / ${GOAL_BTC} BTC`)
      ),
      React.createElement("div", { className:"w-full h-3 bg-slate-800 rounded-full overflow-hidden" },
        React.createElement("div", {
          className:"h-full bg-gradient-to-r from-emerald-600 to-green-400 transition-all",
          style:{ width: progress + "%" }
        })
      ),
      React.createElement("div", { className:"text-[10px] text-right text-slate-500 mt-1" },
        `å‰©é¤˜ ${daysLeft} å¤©ï½œç©©å®šå¹£å æ¯”ç´„ ${stablePct.toFixed(1)}%`
      )
    ),

    /** Content */
    React.createElement("div", { className:"p-4 space-y-4 max-w-xl mx-auto pb-24" },

      /** Tabs */
      React.createElement("div", { className:"flex gap-2 flex-wrap" },
        React.createElement(Chip, { active: tab==="home", onClick:()=>setTab("home") }, "HOME æ¯é€±"),
        React.createElement(Chip, { active: tab==="convert", onClick:()=>setTab("convert") }, "è½‰æ› ETH/ADA"),
        React.createElement(Chip, { active: tab==="orders", onClick:()=>setTab("orders") }, "æ›å–®/90å¤©"),
        React.createElement(Chip, { active: tab==="sop", onClick:()=>setTab("sop") }, "SOP æ†²æ³•")
      ),

      /** Asset cards */
      React.createElement("div", { className:"grid grid-cols-2 gap-3" },
        React.createElement("div", { className:"bg-slate-800 rounded-2xl p-4 border border-slate-700" },
          React.createElement("div", { className:"text-xs text-slate-400" }, "ç†±éŒ¢åŒ… (BTC)"),
          React.createElement("div", { className:"text-2xl mono font-bold mt-1" }, fmt(state.btcHot,4)),
          React.createElement("button", {
            onClick: moveCold,
            className:"mt-3 w-full bg-slate-700 hover:bg-slate-600 rounded-xl py-2 text-sm font-bold"
          }, "æé ˜åˆ°å†·éŒ¢åŒ… (0.05é–€æª»)")
        ),
        React.createElement("div", { className:"bg-slate-800 rounded-2xl p-4 border border-slate-700" },
          React.createElement("div", { className:"text-xs text-slate-400" }, "å†·éŒ¢åŒ… (BTC)"),
          React.createElement("div", { className:"text-2xl mono font-bold mt-1" }, fmt(state.btcCold,4)),
          React.createElement("div", { className:"text-[11px] text-slate-500 mt-2" }, "çµ•å°é˜²ç¦¦é ˜åŸŸ")
        )
      ),

      React.createElement("div", { className:"bg-slate-800 rounded-2xl p-4 border border-slate-700" },
        React.createElement("div", { className:"flex items-center justify-between" },
          React.createElement("div", null,
            React.createElement("div", { className:"text-xs text-slate-400" }, "é å‚™é‡‘ (USDT)"),
            React.createElement("div", { className:"text-2xl mono font-bold mt-1" }, "$" + Math.floor(state.usdtReserve||0).toLocaleString())
          ),
          React.createElement("button", {
            onClick: resetAll,
            className:"text-xs px-3 py-2 rounded-xl bg-slate-700 hover:bg-slate-600 font-bold"
          }, "é‡ç½®")
        ),
        React.createElement("div", { className:"mt-3 grid grid-cols-3 gap-2 items-end" },
          React.createElement("div", { className:"col-span-2" },
            React.createElement("div", { className:"text-xs text-slate-400 mb-1" }, "æ‰‹å‹•è£œå……é å‚™é‡‘ï¼ˆé–’ç½®ç¾é‡‘ï¼‰"),
            React.createElement("input", {
              defaultValue: draftRef.current.extraReserveAdd,
              inputMode:"numeric",
              className:"w-full bg-slate-900 border border-slate-700 rounded-2xl px-4 py-3 text-lg mono focus:outline-none focus:ring-2 focus:ring-emerald-500",
              onInput: (e)=>{ draftRef.current.extraReserveAdd = e.target.value; },
              autoCorrect:"off", autoCapitalize:"off", spellCheck:false
            })
          ),
          React.createElement("button", {
            onClick: addExtraReserve,
            className:"h-[52px] bg-emerald-600 hover:bg-emerald-700 rounded-2xl font-black"
          }, "åŠ å…¥")
        )
      ),

      /** HOME */
      tab==="home" && React.createElement("div", { className:"bg-slate-800 rounded-2xl p-5 border border-slate-700 space-y-4" },
        React.createElement(SectionTitle, { left:"âš¡ æ¯é€±åŸ·è¡Œï¼ˆDCA + é¢¨æ§ï¼‰" }),

        React.createElement(Field, { label:"æœ¬é€± BTC åƒ¹æ ¼ (USDT)", name:"btcPrice", inputMode:"numeric" }),

        // FNG input (0-100)
        React.createElement("div", { className:"space-y-1" },
          React.createElement("div", { className:"flex justify-between items-center" },
            React.createElement("div", { className:"text-xs text-slate-400" }, "ææ‡¼èˆ‡è²ªå©ªæŒ‡æ•¸ (0-100)"),
            React.createElement("div", { className:"text-sm mono text-emerald-300" }, String(ui.fngIndex))
          ),
          React.createElement("input", {
            defaultValue: draftRef.current.fngIndex,
            inputMode:"numeric",
            className:"w-full bg-slate-900 border border-slate-700 rounded-2xl px-4 py-3 text-lg mono focus:outline-none focus:ring-2 focus:ring-emerald-500",
            placeholder:"ä¾‹å¦‚ 50",
            onInput:(e)=>{ draftRef.current.fngIndex = e.target.value; },
            onBlur:()=>{
              let n = parseNum(draftRef.current.fngIndex, ui.fngIndex);
              if(!Number.isFinite(n)) n = ui.fngIndex;
              n = clamp(Math.round(n), 0, 100);
              draftRef.current.fngIndex = String(n);
              setUi(prev => ({ ...prev, fngIndex: n }));
            },
            autoCorrect:"off", autoCapitalize:"off", spellCheck:false
          }),
          React.createElement("div", { className:"text-[11px] text-slate-500" },
            `è²ªå©ªé€£çºŒé€±æ•¸ï¼š${state.consecutiveGreedWeeks}ï¼ˆ>${GREED_THRESHOLD} é€£çºŒ ${GREED_WEEKS_FOR_INSURANCE} é€±å¾Œå•Ÿå‹•é•·ç‰›ä¿éšªï¼‰`
          )
        ),

        React.createElement("div", { className:"grid grid-cols-2 gap-3" },
          React.createElement(Field, { label:"ETH/BTC åŒ¯ç‡ï¼ˆç›£æ§/è½‰æ›ç”¨ï¼‰", name:"ethBtcRatio", inputMode:"decimal" }),
          React.createElement(Field, { label:"ADA/BTC åŒ¯ç‡ï¼ˆç›£æ§/è½‰æ›ç”¨ï¼‰", name:"adaBtcRatio", inputMode:"decimal" })
        ),

        React.createElement("div", { className:"bg-slate-900 border border-slate-700 rounded-2xl p-4 space-y-3" },
          React.createElement("div", { className:"text-sm font-extrabold text-yellow-200" }, "ğŸ§± é»‘å¤©éµè§¸ç™¼æ¢ä»¶ï¼ˆæ‰‹å‹•å¡«å¯«/åˆ‡æ›ï¼‰"),
          React.createElement(Field, { label:"ATH å›æ’¤ (%) ä¾‹å¦‚ 35 è¡¨ç¤º -35%", name:"athDrawdownPct", inputMode:"numeric" }),
          React.createElement(Toggle01, { label:"BTC è·Œç ´ 200W MAï¼ˆON=æ˜¯ï¼‰", name:"below200w" }),
          React.createElement(Field, { label:"è²·å…¥æœŸé–“çš„åå½ˆ (%)ï¼ˆ>15% è‡ªå‹•åœæ­¢é»‘å¤©éµè²·å…¥ï¼‰", name:"reboundPct", inputMode:"numeric" }),
          React.createElement("div", { className:"text-[11px] text-slate-500" },
            state.blackSwan.active
              ? `é»‘å¤©éµé€²è¡Œä¸­ï¼šåŸå› =${state.blackSwan.reason}ï½œå‰© ${state.blackSwan.remainingWeeks} é€±ï½œé€±é¡ç´„ ${Math.floor(state.blackSwan.weeklyBudget)}U`
              : "é»‘å¤©éµç›®å‰æœªå•Ÿå‹•ï¼ˆFNG<20 æˆ– ATHå›æ’¤>=30 æˆ– è·Œç ´200W æ™‚æœƒå•Ÿå‹•ï¼Œé å‚™é‡‘åˆ†4é€±è²·å…¥ï¼‰"
          )
        ),

        React.createElement("button", {
          onClick: executeWeekly,
          className:"w-full bg-emerald-600 hover:bg-emerald-700 rounded-2xl py-4 text-lg font-black"
        }, "åŸ·è¡Œæœ¬é€±æ±ºç­– (EXECUTE)")
      ),

      /** CONVERT */
      tab==="convert" && React.createElement("div", { className:"bg-slate-800 rounded-2xl p-5 border border-slate-700 space-y-4" },
        React.createElement("div", { className:"text-lg font-extrabold text-fuchsia-300" }, "ğŸ”„ ç¬¬äºŒç« ï¼šæˆ°ç•¥è½‰æ›ï¼ˆETH/ADA âœ BTCï¼‰"),
        React.createElement("div", { className:"text-sm text-slate-300" },
          `ç›®å‰æŒæœ‰ï½œETH: ${fmt(state.eth,2)}ï½œADA: ${Math.floor(state.ada).toLocaleString()}`
        ),
        React.createElement("div", { className:"text-xs text-slate-500" },
          `ç›£æ§ï½œETH/BTC=${ui.ethBtcRatio}ï¼ˆéšæ®µ ${ethStage}ï¼‰ï½œADA/BTC=${ui.adaBtcRatio}ï¼ˆéšæ®µ ${adaStage}ï¼‰`
        ),

        // ETH Stage Buttons
        React.createElement("div", { className:"bg-slate-900 border border-slate-700 rounded-2xl p-4 space-y-3" },
          React.createElement("div", { className:"font-bold text-white" }, "ETH ç­–ç•¥ï¼ˆæ··åˆï¼šBTC + USDT æ›å–®å›æ¥ï¼‰"),
          React.createElement("div", { className:"text-xs text-slate-400" },
            "ä¸€éš 0.060ï¼š10ETHï¼ˆ5â†’BTCï¼›5â†’USDT æ›å–®å›æ’¤15% æ¥å›ï¼‰ï½œäºŒéš 0.065ï¼š12ETHï¼ˆ6â†’BTCï¼›6â†’USDT å›æ’¤20%ï¼‰ï½œä¸‰éš 0.075ï¼š12ETH å…¨æ› BTC"
          ),

          // Stage 1
          React.createElement("div", { className:"grid grid-cols-2 gap-2" },
            React.createElement("button", {
              className:"bg-slate-700 hover:bg-slate-600 rounded-xl py-3 text-sm font-black",
              onClick: ()=> {
                if(ui.ethBtcRatio < ETH_STAGE1){ setModal({title:"æœªé”é–€æª»", body:`ETH/BTC éœ€ >= ${ETH_STAGE1}`}); return; }
                const btc = prompt("ä¸€éšï¼šè«‹è¼¸å…¥ 5 ETH ç›´æ¥æ›åˆ°çš„ BTC æ•¸é‡ï¼ˆä¾‹å¦‚ 0.3000ï¼‰","");
                if(!btc) return;
                const ok = executeConvertDirectToBTC("ETH", 5, parseNum(btc, NaN));
                if(!ok) return;
                const usdt = prompt("ä¸€éšï¼šè«‹è¼¸å…¥ 5 ETH æ›åˆ°çš„ USDT æ•¸é‡ï¼ˆä¾‹å¦‚ 12000ï¼‰","");
                if(!usdt) return;
                executeConvertToUSDTWithOrder(5, parseNum(usdt, NaN), BUYBACK_DROP_STAGE1);
              }
            }, "åŸ·è¡Œ ETH ä¸€éšï¼ˆ10é¡†ï¼‰"),

            React.createElement("button", {
              className:"bg-slate-700 hover:bg-slate-600 rounded-xl py-3 text-sm font-black",
              onClick: ()=> {
                setModal({
                  title:"æç¤º",
                  body:"ä¸€éšæœƒå»ºç«‹ USDT æ›å–®ï¼šBTC å›æ’¤ 15% æ¥å› + 90 å¤©æœ€æ™šå›å®¶ã€‚å®Œæˆå¾Œè«‹åˆ°ã€æ›å–®/90å¤©ã€‘é æª¢æŸ¥ã€‚"
                });
              }
            }, "ä¸€éšè¦å‰‡èªªæ˜")
          ),

          // Stage 2
          React.createElement("div", { className:"grid grid-cols-2 gap-2" },
            React.createElement("button", {
              className:"bg-slate-700 hover:bg-slate-600 rounded-xl py-3 text-sm font-black",
              onClick: ()=> {
                if(ui.ethBtcRatio < ETH_STAGE2){ setModal({title:"æœªé”é–€æª»", body:`ETH/BTC éœ€ >= ${ETH_STAGE2}`}); return; }
                const btc = prompt("äºŒéšï¼šè«‹è¼¸å…¥ 6 ETH ç›´æ¥æ›åˆ°çš„ BTC æ•¸é‡","");
                if(!btc) return;
                const ok = executeConvertDirectToBTC("ETH", 6, parseNum(btc, NaN));
                if(!ok) return;
                const usdt = prompt("äºŒéšï¼šè«‹è¼¸å…¥ 6 ETH æ›åˆ°çš„ USDT æ•¸é‡","");
                if(!usdt) return;
                executeConvertToUSDTWithOrder(6, parseNum(usdt, NaN), BUYBACK_DROP_STAGE2);
              }
            }, "åŸ·è¡Œ ETH äºŒéšï¼ˆ12é¡†ï¼‰"),

            React.createElement("button", {
              className:"bg-slate-700 hover:bg-slate-600 rounded-xl py-3 text-sm font-black",
              onClick: ()=> {
                setModal({ title:"äºŒéšè¦å‰‡", body:"äºŒéš USDT æ›å–®å›æ’¤ 20% æ¥å›ï¼Œä¸¦æœ‰ 90 å¤©æœ€æ™šå›å®¶ã€‚" });
              }
            }, "äºŒéšè¦å‰‡èªªæ˜")
          ),

          // Stage 3
          React.createElement("button", {
            className:"w-full bg-fuchsia-600 hover:bg-fuchsia-700 rounded-2xl py-4 text-sm font-black",
            onClick: ()=> {
              if(ui.ethBtcRatio < ETH_STAGE3){ setModal({title:"æœªé”é–€æª»", body:`ETH/BTC éœ€ >= ${ETH_STAGE3}`}); return; }
              const btc = prompt("ä¸‰éšï¼šè«‹è¼¸å…¥ 12 ETH å…¨æ›åˆ°çš„ BTC æ•¸é‡","");
              if(!btc) return;
              executeConvertDirectToBTC("ETH", 12, parseNum(btc, NaN));
            }
          }, "åŸ·è¡Œ ETH ä¸‰éšï¼ˆ12é¡†å…¨æ› BTCï¼‰")
        ),

        // ADA
        React.createElement("div", { className:"bg-slate-900 border border-slate-700 rounded-2xl p-4 space-y-3" },
          React.createElement("div", { className:"font-bold text-white" }, "ADA é€ƒç”Ÿè‰™ï¼ˆé”æ¨™å³æ’¤ï¼Œæ°¸ä¹…ä¸å›è£œï¼‰"),
          React.createElement("div", { className:"text-xs text-slate-400" },
            "ä¸€éš 0.000010ï¼š40,000 ADA â†’ BTCï½œäºŒéš 0.000013ï¼š34,000 ADA â†’ BTC"
          ),
          React.createElement("div", { className:"grid grid-cols-2 gap-2" },
            React.createElement("button", {
              className:"bg-slate-700 hover:bg-slate-600 rounded-xl py-3 text-sm font-black",
              onClick: ()=> {
                if(ui.adaBtcRatio < ADA_STAGE1){ setModal({title:"æœªé”é–€æª»", body:`ADA/BTC éœ€ >= ${ADA_STAGE1}`}); return; }
                const btc = prompt("ADA ä¸€éšï¼šè«‹è¼¸å…¥ 40,000 ADA æ›åˆ°çš„ BTC æ•¸é‡","");
                if(!btc) return;
                executeConvertDirectToBTC("ADA", 40000, parseNum(btc, NaN));
              }
            }, "åŸ·è¡Œ ADA ä¸€éšï¼ˆ4è¬ï¼‰"),
            React.createElement("button", {
              className:"bg-slate-700 hover:bg-slate-600 rounded-xl py-3 text-sm font-black",
              onClick: ()=> {
                if(ui.adaBtcRatio < ADA_STAGE2){ setModal({title:"æœªé”é–€æª»", body:`ADA/BTC éœ€ >= ${ADA_STAGE2}`}); return; }
                const btc = prompt("ADA äºŒéšï¼šè«‹è¼¸å…¥ 34,000 ADA æ›åˆ°çš„ BTC æ•¸é‡","");
                if(!btc) return;
                executeConvertDirectToBTC("ADA", 34000, parseNum(btc, NaN));
              }
            }, "åŸ·è¡Œ ADA äºŒéšï¼ˆ3.4è¬ï¼‰")
          )
        )
      ),

      /** ORDERS */
      tab==="orders" && React.createElement("div", { className:"bg-slate-800 rounded-2xl p-5 border border-slate-700 space-y-4" },
        React.createElement("div", { className:"text-lg font-extrabold text-sky-300" }, "ğŸ“Œ ETHâ†’USDT æ›å–®å›æ¥ + 90å¤©æœ€æ™šå›å®¶"),
        React.createElement("div", { className:"text-sm text-slate-300" },
          "ä½ æ¯é€±åœ¨ HOME è¼¸å…¥ BTC åƒ¹æ ¼ï¼Œç„¶å¾Œåœ¨é€™è£¡æŒ‰ã€Œæª¢æŸ¥/æ¥å›ã€ã€‚é”æ¨™æœƒç”¨å¸‚åƒ¹æ¨¡æ“¬è²·å› BTCï¼›åˆ°æœŸæœƒè‡ªå‹•åœ¨ã€Œæ¯é€±åŸ·è¡Œã€æ™‚å¼·åˆ¶è²·å›ã€‚"
        ),
        React.createElement("button", {
          onClick: checkAndBuybackOrders,
          className:"w-full bg-sky-600 hover:bg-sky-700 rounded-2xl py-4 text-lg font-black"
        }, "æª¢æŸ¥æ›å–®/é”æ¨™æ¥å›"),

        React.createElement("div", { className:"bg-slate-900 border border-slate-700 rounded-2xl p-4" },
          React.createElement("div", { className:"text-xs text-slate-500 mono mb-2" }, "> PENDING ORDERS"),
          (state.pendingOrders.length === 0)
            ? React.createElement("div", { className:"text-slate-600 text-sm" }, "ç›®å‰æ²’æœ‰æ›å–®ã€‚")
            : state.pendingOrders.slice(0, 20).map(o => {
                const open = o.status === "open";
                const created = o.createdAtISO ? o.createdAtISO.slice(0,10) : "-";
                const deadline = o.deadlineISO ? o.deadlineISO.slice(0,10) : "-";
                const left = o.deadlineISO ? Math.max(0, Math.ceil((new Date(o.deadlineISO).getTime() - Date.now())/(1000*60*60*24))) : "-";
                return React.createElement("div", { key:o.id, className:"border-b border-slate-800 py-3 last:border-0" },
                  React.createElement("div", { className:"flex items-center justify-between" },
                    React.createElement("div", { className:"text-sm font-bold " + (open ? "text-yellow-300" : "text-slate-400") },
                      open ? "OPEN" : "CLOSED"
                    ),
                    React.createElement("div", { className:"text-xs text-slate-500 mono" },
                      open ? `å‰© ${left} å¤©` : (o.closedReason || "")
                    )
                  ),
                  React.createElement("div", { className:"text-xs text-slate-400 mt-1 mono" },
                    `USDT=${Math.floor(o.usdtAmount||0)}ï½œåƒè€ƒBTC=${Math.floor(o.refBtcPrice||0)}ï½œå›æ’¤=${o.dropPct}%ï½œæ¥å›åƒ¹â‰¤${Math.floor(o.targetPrice||0)}`
                  ),
                  React.createElement("div", { className:"text-[11px] text-slate-500 mt-1" },
                    `å»ºç«‹ ${created}ï½œåˆ°æœŸ ${deadline}`
                  ),
                  (!open && o.btcReceived)
                    ? React.createElement("div", { className:"text-xs text-emerald-300 mono mt-1" },
                        `æ¥å› BTC +${o.btcReceived.toFixed(6)}`
                      )
                    : null
                );
              })
        )
      ),

      /** SOP */
      tab==="sop" && React.createElement("div", { className:"bg-slate-800 rounded-2xl p-5 border border-slate-700 space-y-4" },
        React.createElement("div", { className:"text-lg font-extrabold text-yellow-300" }, "ğŸ“œ åŸ·è¡Œæ†²æ³•ï¼ˆæ‘˜è¦ï¼‰"),
        React.createElement("div", { className:"text-sm text-slate-300 leading-relaxed space-y-3" },
          React.createElement("div", { className:"bg-slate-900 border border-slate-700 rounded-2xl p-4" },
            React.createElement("div", { className:"font-bold text-white mb-2" }, "ç¬¬ä¸€ç« ï¼šå®šæŠ•é€²æ”»ï¼ˆæ¯é€±çœ‹æè²ªï¼‰"),
            React.createElement("ul", { className:"list-disc pl-5 space-y-1 text-slate-300" },
              React.createElement("li", null, "A <20ï¼š3 ä»½è²·é€² + å•Ÿå‹•é»‘å¤©éµé å‚™é‡‘"),
              React.createElement("li", null, "B 20-40ï¼š2 ä»½è²· / 1 ä»½å­˜"),
              React.createElement("li", null, "C 40-75ï¼š1 ä»½è²· / 2 ä»½å­˜"),
              React.createElement("li", null, "D >75ï¼š0 è²· / 3 ä»½å­˜"),
              React.createElement("li", null, "å¼·åˆ¶æ¢æ¬¾ï¼š>75 é€£çºŒ 8 é€±å¾Œï¼Œé•·ç‰›ä¿éšªå•Ÿå‹•ï¼š1 ä»½è²· / 2 ä»½å­˜")
            )
          ),
          React.createElement("div", { className:"bg-slate-900 border border-slate-700 rounded-2xl p-4" },
            React.createElement("div", { className:"font-bold text-white mb-2" }, "ç¬¬ä¸‰ç« ï¼šé»‘å¤©éµé å‚™é‡‘"),
            React.createElement("ul", { className:"list-disc pl-5 space-y-1 text-slate-300" },
              React.createElement("li", null, "è§¸ç™¼ï¼šFNG<20 æˆ– ATH å›æ’¤â‰¥30% æˆ– è·Œç ´ 200W MA"),
              React.createElement("li", null, "æ–¹å¼ï¼šé å‚™é‡‘åˆ† 4 é€±ç­‰é¡è²·å…¥"),
              React.createElement("li", null, "åœæ­¢ï¼šè²·å…¥æœŸé–“åå½ˆ >15% ç«‹å³åœæ­¢ï¼Œä¿ç•™å‰©é¤˜å­å½ˆ")
            )
          ),
          React.createElement("div", { className:"bg-slate-900 border border-slate-700 rounded-2xl p-4" },
            React.createElement("div", { className:"font-bold text-white mb-2" }, "ç¬¬äºŒç« ï¼šETH/ADA âœ BTC"),
            React.createElement("ul", { className:"list-disc pl-5 space-y-1 text-slate-300" },
              React.createElement("li", null, "ETHï¼š0.060/0.065 æ··åˆï¼ˆBTC+USDTæ›å–®æ¥å›ï¼‰ï¼›0.075 å…¨æ› BTC"),
              React.createElement("li", null, "USDT æœ€æ™šå›å®¶ï¼š90 å¤©å…§æœªå›æ’¤é”åƒ¹ï¼Œå¼·åˆ¶å¸‚åƒ¹æ›å› BTC"),
              React.createElement("li", null, "ADAï¼šé”æ¨™å³æ’¤ï¼ˆé€ƒç”Ÿè‰™ï¼‰ï¼Œæ°¸ä¹…ä¸å›è£œ")
            )
          ),
          React.createElement("div", { className:"bg-slate-900 border border-slate-700 rounded-2xl p-4" },
            React.createElement("div", { className:"font-bold text-white mb-2" }, "ç¬¬å››ç« ï¼šéµè¡€ç´€å¾‹"),
            React.createElement("ul", { className:"list-disc pl-5 space-y-1 text-slate-300" },
              React.createElement("li", null, "äº¤æ˜“æ‰€ç´¯ç© â‰¥0.05 BTC â†’ ç«‹å³æé ˜å†·éŒ¢åŒ…"),
              React.createElement("li", null, "è­¦å ±æ²’éŸ¿ï¼šå°ˆå¿ƒå·¥ä½œã€é™ªä¼´å®¶äºº")
            )
          )
        )
      ),

      /** LOGS */
      React.createElement("div", { className:"bg-slate-950 rounded-2xl p-4 border border-slate-800" },
        React.createElement("div", { className:"text-xs text-slate-500 mono mb-2" }, "> SYSTEM LOGS"),
        state.logs.length === 0
          ? React.createElement("div", { className:"text-slate-600 text-sm" }, "ç­‰å¾…æŒ‡ä»¤â€¦")
          : state.logs.slice(0, 18).map(l =>
              React.createElement("div", { key:l.id, className:"text-sm mono border-b border-slate-900 py-2 last:border-0" },
                React.createElement("span", { className:"text-slate-500" }, `[${l.date}] `),
                React.createElement("span", {
                  className:
                    l.type==="alert" ? "text-red-300 font-bold" :
                    l.type==="success" ? "text-emerald-300" :
                    l.type==="warning" ? "text-yellow-300" :
                    l.type==="secure" ? "text-sky-300" : "text-slate-300"
                }, l.msg)
              )
            )
      )
    ),

    /** Modal */
    modal && React.createElement("div", { className:"fixed inset-0 z-50 bg-black/70 flex items-center justify-center p-4" },
      React.createElement("div", { className:"w-full max-w-md bg-slate-900 border border-slate-700 rounded-2xl p-5" },
        React.createElement("div", { className:"text-lg font-black mb-3" }, modal.title),
        React.createElement("pre", { className:"text-sm text-slate-200 whitespace-pre-wrap leading-relaxed" }, modal.body),
        React.createElement("button", {
          onClick:()=>setModal(null),
          className:"mt-4 w-full bg-slate-700 hover:bg-slate-600 rounded-xl py-3 font-bold"
        }, "ç¢ºèª")
      )
    )
  );
}

/** Boot */
const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(React.createElement(App));
</script>
</body>
</html>
