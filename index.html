<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Project 2030ÔºöÊÜ≤Ê≥ïÂÆàË≠∑ËÄÖ</title>

  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">

  <style>
    body{
      margin:0;
      background:#0b1220;
      color:#e5e7eb;
      font-family:'Noto Sans TC',sans-serif;
    }
    .pixel{font-family:'Press Start 2P',cursive;}
    .card{
      background:rgba(15,23,42,.85);
      border:1px solid rgba(255,255,255,.08);
      border-radius:16px;
      box-shadow:0 12px 40px rgba(0,0,0,.45);
    }
    input{font-size:16px;} /* iOS ÈçµÁõ§Á©©ÂÆö */
    .pb-safe{padding-bottom:calc(88px + env(safe-area-inset-bottom));}
  </style>
</head>

<body>
<div id="root"></div>

<script>
const {useState,useEffect,useRef,useMemo} = React;

const GOAL_BTC = 3;
const TARGET_DATE = new Date("2030-12-31").getTime();
const SAVE_KEY = "project2030_final_save";

const INITIAL_STATE = {
  btc:0,
  coldWalletCount:0,
  usdtReserve:0,
  eth:34,
  ada:74000,
  logs:[],
  consecutiveGreedWeeks:0
};

function mmdd(){
  const d=new Date();
  return `${String(d.getMonth()+1).padStart(2,'0')}/${String(d.getDate()).padStart(2,'0')}`;
}
function clamp(n,a,b){return Math.max(a,Math.min(b,n));}

function App(){
  const [state,setState]=useState(INITIAL_STATE);
  const [tab,setTab]=useState("dashboard");
  const [modal,setModal]=useState(null);

  const inputRef=useRef({
    btcPrice:"90000",
    fng:"50",
    eth:"0.05",
    ada:"0.000008"
  });

  const [ui,setUi]=useState({
    btcPrice:90000,
    fngIndex:50,
    eth:0.05,
    ada:0.000008
  });

  useEffect(()=>{
    const saved=localStorage.getItem(SAVE_KEY);
    if(saved) setState(JSON.parse(saved));
    else addLog("Á≥ªÁµ±ÂàùÂßãÂåñÂÆåÊàê„ÄÇÁõÆÊ®ôÔºö2030 Á¥ØÁ©ç 3 BTC„ÄÇ","system");
  },[]);

  useEffect(()=>{
    localStorage.setItem(SAVE_KEY,JSON.stringify(state));
  },[state]);

  function addLog(msg,type="info"){
    setState(p=>({...p,logs:[{id:Date.now(),date:mmdd(),msg,type},...p.logs].slice(0,50)}));
  }

  const totalBTC=state.btc+state.coldWalletCount;
  const progress=clamp(totalBTC/GOAL_BTC*100,0,100);
  const daysLeft=Math.ceil((TARGET_DATE-Date.now())/(1000*60*60*24));

  function executeWeekly(){
    const fng=clamp(ui.fngIndex,0,100);
    const price=ui.btcPrice;
    if(!price||price<=0){setModal("BTC ÂÉπÊ†ºÈåØË™§");return;}

    let spent=0,saved=0,used=0,greed=state.consecutiveGreedWeeks,action="";
    if(fng<20){
      action="Ê•µÂ∫¶ÊÅêÊÖåÔºöÂÖ®Ë≤∑+È†êÂÇôÈáë";
      spent=180;
      if(state.usdtReserve>0){used=Math.floor(state.usdtReserve*0.25);spent+=used;}
      greed=0;
    }else if(fng<=40){
      action="ÊÅêÊáºÔºö2Ë≤∑1Â≠ò";spent=120;saved=60;greed=0;
    }else if(fng<=75){
      action="‰∏≠ÊÄßÔºö1Ë≤∑2Â≠ò";spent=60;saved=120;greed=0;
    }else{
      if(greed>=8){action="Èï∑Áâõ‰øùÈö™";spent=60;saved=120;greed++;}
      else{action="Ë≤™Â©™ÔºöÂÖ®Â≠ò";saved=180;greed++;}
    }

    const bought=spent>0?spent/price:0;

    const next={
      ...state,
      btc:state.btc+bought,
      usdtReserve:state.usdtReserve+saved-used,
      consecutiveGreedWeeks:greed
    };
    setState(next);

    addLog(`ÈÄ±Â†±Ôºö${action}`,spent?"success":"warning");
    if(bought) addLog(`Ë≤∑ÂÖ• ${bought.toFixed(6)} BTC @ ${price}`,"success");

    setModal(`ÊäïÂÖ• ${spent}UÔºåÁç≤Âæó ${bought.toFixed(6)} BTC`);
  }

  function moveCold(){
    if(state.btc<0.05){setModal("Êú™ÈÅî 0.05 BTC");return;}
    const amt=state.btc;
    setState(p=>({...p,btc:0,coldWalletCount:p.coldWalletCount+amt}));
    addLog(`ÊèêÈ†ò ${amt.toFixed(6)} BTC Ëá≥ÂÜ∑Èå¢ÂåÖ`,"secure");
  }

  /* üîπ ÊÅêÊáºË≤™Â©™ÊåáÊï∏ÔºöÊâãÂãïËº∏ÂÖ•ÁâàÔºàÂîØ‰∏ÄÊîπÂãïÔºâ */
  function FngInput(){
    return (
      React.createElement("div",null,
        React.createElement("label",{className:"text-xs text-slate-300 mb-1 block"},"ÊÅêÊáºËàáË≤™Â©™ÊåáÊï∏ (0‚Äì100)"),
        React.createElement("input",{
          type:"text",
          inputMode:"numeric",
          defaultValue:inputRef.current.fng,
          className:"w-full bg-black/40 border border-white/10 rounded-xl px-3 py-3 font-mono",
          onChange:e=>inputRef.current.fng=e.target.value,
          onBlur:e=>{
            let n=parseInt(inputRef.current.fng);
            if(!Number.isFinite(n)) n=ui.fngIndex;
            n=clamp(n,0,100);
            inputRef.current.fng=String(n);
            setUi(p=>({...p,fngIndex:n}));
          }
        })
      )
    );
  }

  function NumberField(label,key){
    return React.createElement("div",null,
      React.createElement("label",{className:"text-xs text-slate-300 mb-1 block"},label),
      React.createElement("input",{
        type:"text",inputMode:"decimal",
        defaultValue:inputRef.current[key],
        className:"w-full bg-black/40 border border-white/10 rounded-xl px-3 py-3 font-mono",
        onChange:e=>inputRef.current[key]=e.target.value,
        onBlur:e=>{
          const v=parseFloat(inputRef.current[key]);
          if(Number.isFinite(v)) setUi(p=>({...p,[key==="btcPrice"?"btcPrice":key]:v}));
        }
      })
    );
  }

  return React.createElement("div",null,
    React.createElement("div",{className:"sticky top-0 bg-black/80 p-4"},
      React.createElement("div",{className:"text-xs flex justify-between"},
        React.createElement("span",{className:"pixel"},"LV."+Math.floor(totalBTC*10)),
        React.createElement("span",{className:"font-mono"},`${totalBTC.toFixed(4)}/${GOAL_BTC}`)
      ),
      React.createElement("div",{className:"h-3 bg-white/10 rounded-full overflow-hidden mt-2"},
        React.createElement("div",{className:"h-full bg-emerald-500",style:{width:progress+"%"}})
      ),
      React.createElement("div",{className:"text-[10px] text-right text-slate-400"},`Ââ©È§ò ${daysLeft} Â§©`)
    ),

    React.createElement("div",{className:"p-4 pb-safe space-y-4 max-w-xl mx-auto"},
      React.createElement("div",{className:"grid grid-cols-2 gap-3"},
        React.createElement("div",{className:"card p-4"},
          React.createElement("div",{className:"text-xs"},"ÁÜ±Èå¢ÂåÖ"),
          React.createElement("div",{className:"text-2xl font-mono"},state.btc.toFixed(4)),
          React.createElement("button",{onClick:moveCold,className:"mt-2 w-full bg-white/10 rounded-xl py-2"},"ÊèêÈ†ò")
        ),
        React.createElement("div",{className:"card p-4"},
          React.createElement("div",{className:"text-xs"},"ÂÜ∑Èå¢ÂåÖ"),
          React.createElement("div",{className:"text-2xl font-mono"},state.coldWalletCount.toFixed(4))
        )
      ),

      React.createElement("div",{className:"card p-4"},
        React.createElement(NumberField,"BTC ÂÉπÊ†º (USDT)","btcPrice"),
        React.createElement(FngInput,null),
        React.createElement("button",{onClick:executeWeekly,className:"mt-4 w-full bg-emerald-600 py-4 rounded-xl font-bold"},"Âü∑Ë°åÊØèÈÄ±Ê±∫Á≠ñ")
      ),

      React.createElement("div",{className:"card p-4"},
        React.createElement("div",{className:"text-xs font-mono"},"LOG"),
        state.logs.slice(0,8).map(l=>
          React.createElement("div",{key:l.id,className:"text-sm font-mono"},
            `[${l.date}] ${l.msg}`
          )
        )
      )
    ),

    modal && React.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center"},
      React.createElement("div",{className:"card p-6"},
        React.createElement("div",{className:"mb-4"},modal),
        React.createElement("button",{onClick:()=>setModal(null),className:"w-full bg-white/10 py-2 rounded-xl"},"Á¢∫Ë™ç")
      )
    )
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(App));
</script>
</body>
</html>
