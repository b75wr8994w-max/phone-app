<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Project 2030：憲法守護者</title>

  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">

  <style>
    body {
      background-color: #111827;
      font-family: 'Noto Sans TC', sans-serif;
      color: #e5e7eb;
    }

    .pixel {
      font-family: 'Press Start 2P', monospace;
    }

    /* ===== CRT 視覺層（不吃點擊）===== */
    .crt {
      position: relative;
    }

    .crt::before {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 9999;
      background:
        linear-gradient(rgba(18,16,16,0) 50%, rgba(0,0,0,0.25) 50%),
        linear-gradient(90deg,
          rgba(255,0,0,0.05),
          rgba(0,255,0,0.02),
          rgba(0,0,255,0.05)
        );
      background-size: 100% 2px, 3px 100%;
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const GOAL_BTC = 3;
    const TARGET_DATE = new Date("2030-12-31").getTime();

    const INITIAL = {
      btc: 0,
      reserve: 0,
      logs: [],
    };

    function App() {
      const [state, setState] = useState(INITIAL);
      const [btcPrice, setBtcPrice] = useState(90000);
      const [fng, setFng] = useState(50);

      useEffect(() => {
        const saved = localStorage.getItem("p2030");
        if (saved) setState(JSON.parse(saved));
        else addLog("系統初始化完成");
      }, []);

      useEffect(() => {
        localStorage.setItem("p2030", JSON.stringify(state));
      }, [state]);

      function addLog(msg) {
        setState(s => ({
          ...s,
          logs: [
            { id: Date.now(), msg },
            ...s.logs
          ].slice(0, 20)
        }));
      }

      function execute() {
        let spent = 0;
        let saved = 0;

        if (fng < 20) {
          spent = 180;
          addLog("極度恐慌：全力買進");
        } else if (fng < 40) {
          spent = 120;
          saved = 60;
          addLog("恐懼：加碼進攻");
        } else if (fng < 75) {
          spent = 60;
          saved = 120;
          addLog("中性：保守推進");
        } else {
          saved = 180;
          addLog("貪婪：全面存錢");
        }

        const btc = spent / btcPrice;

        setState(s => ({
          ...s,
          btc: s.btc + btc,
          reserve: s.reserve + saved
        }));
      }

      const progress = Math.min(100, (state.btc / GOAL_BTC) * 100);
      const daysLeft = Math.ceil((TARGET_DATE - Date.now()) / 86400000);

      return (
        <div className="crt min-h-screen p-4 pb-24">
          <h1 className="pixel text-xl text-green-400 text-center mb-2">
            PROJECT 2030
          </h1>
          <p className="text-center text-xs text-gray-400 mb-4">
            剩餘 {daysLeft} 天
          </p>

          <div className="bg-gray-800 p-4 rounded-xl mb-4">
            <div className="flex justify-between text-xs mb-1">
              <span>BTC 進度</span>
              <span>{state.btc.toFixed(4)} / 3.0000</span>
            </div>
            <div className="h-3 bg-gray-700 rounded overflow-hidden">
              <div
                className="h-full bg-green-500"
                style={{ width: progress + "%" }}
              />
            </div>
          </div>

          <div className="bg-gray-800 p-4 rounded-xl mb-4">
            <label className="text-xs text-gray-400">BTC 價格</label>
            <input
              type="number"
              className="w-full p-2 bg-gray-900 rounded mt-1"
              value={btcPrice}
              onChange={e => setBtcPrice(+e.target.value)}
            />

            <label className="text-xs text-gray-400 mt-4 block">
              恐懼 / 貪婪：{fng}
            </label>
            <input
              type="range"
              min="0"
              max="100"
              value={fng}
              onChange={e => setFng(+e.target.value)}
              className="w-full accent-green-500"
            />

            <button
              onClick={execute}
              className="w-full mt-4 bg-green-600 active:bg-green-700 py-3 rounded font-bold"
            >
              執行每週決策
            </button>
          </div>

          <div className="bg-black p-3 rounded text-xs font-mono">
            {state.logs.map(l => (
              <div key={l.id}>> {l.msg}</div>
            ))}
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
